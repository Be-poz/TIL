# HBase

## HBase 개요

HBase는 HDFS 기반으로 구현한 컬럼 기반 분산 데이터베이스다.  
HBase는 대규모 데이터셋에서 실시간으로 읽고 쓰는 랜덤 액세스가 필요할 때 사용할 수 있는 하둡 애플리케이션이다.  

HBase는 완전히 다른 방향에서 확장성 문제에 접근했다. 단지 노드만 추가하면 선형으로 확장 할 수 있는 기반으로 구축했다.  
HBase는 관계형 구조가 아니며 SQL을 지원하지 않지만 특정 영역에서는 RDBMS가 할 수 없는 문제를 해결해준다.  
HBase를 이용하면 상용 하드웨어로 구성된 클러스터에서 대용량의 산재된 테이블을 관리할 수 있다.  

<br/>

## 개념

<img width="880" alt="image" src="https://github.com/Be-poz/TIL/assets/45073750/466ddf70-e565-494b-a3a1-8581ca4bb229">

rowKey는 바이트 배열이므로, 이론적으로 문자열부터 long 형의 바이너리 표현, 심지어 직렬화된 데이터 구조까지 어떠한 것도 로우 키로 사용할 수 있다. 테이블의 row는 rowKey로 정렬된다. 정렬은 바이트 순서다. 모든 테이블은 주 키를 통해 접근할 수 있다.  

로우의 컬럼들은 컬럼 패밀리로 그룹지어진다. 모든 컬럼 패밀리의 멤버는 공통 접두사를 가지는데, info:format 과 info:geo에서 format과 geo 컬럼은 동일한 info라는 컬럼패밀리를 가진다. 그리고 콜론 문자로 나뉜다.  

HBase 테이블은 RDBMS와 유사하지만, 셀은 버전별로 관리되고, 로우는 정렬되며, 컬럼이 속할 컬럼 패밀리가 미리 존재하는 한 언제든지 클라이언트는 컬럼을 추가할 수 있다.  

### 리전

HBase는 테이블을 자동으로 리전(region)단위로 수평 분할한다. 각 리전은 테이블의 로우의 부분집합으로 구성된다.  
리전은 자신이 속한 테이블, 첫 번째 로우, 마지막 로우로 정의된다.  

리전이 점차적으로 커지면서 설정된 임계 크기를 넘어서면 하나의 로우를 경계로 대략 동일한 크기의 새로운 리전 2개로 분할된다.  
처음 분할될 때까지 모든 로딩은 초기 리전을 호스팅하는 단일 서버에서 일어난다. 리전은 HBase 클러스터에 분산되는 단위다. 이런 식으로 하나의 서버에겐 너무 큰 테이블도 서버 클러스터에서 다뤄질 수 있으며, 각 서버는 테이블의 전체 리전의 일부분을 호스팅한다. 이것이 바로 테이블의 데이터 로드를 분산시키는 방식이다. 가동되고 있는 정렬된 리전 집합은 테이블의 전체 내용을 나눠서 보관한다.  

### 락킹

로우 업데이트는 로우 수준 트랜잭션에 포함된 로우 컬럼의 개수와 상관없이 원자적이다.  

<br/>

### 구현

HDFS와 YARN이 클라이언트, 워커, 관리 마스터(HDFS의 네임노드와 데이터노드, YARN의 리소스 매니저와 노드 매니저)로 이루어진 것처럼, HBase도 하나 이상의 리전서버 워커로 구성된 클러스터를 조율하는 HBase 마스터 노드로 이루어진다.  

HBase 마스터는 최초 설치를 부트스트랩핑하는 역할을 수행하고, 등록된 리전서버에 리전을 할당하며, 실패한 리전서버를 복구할 책임을 가진다. 마스터 노드는 가볍게 시작된다. 리전서버는 0개 이상의 리전을 다루며 클라이언트의 읽기/쓰기 요청을 처리한다. 또 리전 스플릿을 관리하고, 새로운 자식 리전을 HBase 마스터에 알려줌으로써 마스터가 부모 리전과의 연결을 끊고 대신 자식을 할당하게 한다.  

<img width="530" alt="image" src="https://github.com/Be-poz/TIL/assets/45073750/2014e302-38a1-4bc0-bd67-b42c2f4a8165">

HBase는 주키퍼에 의존하며, 기본적으로 클러스터 상태를 지휘하는 주키퍼 인스턴스를 자체 관리하지만, 이미 존재하는 주키퍼 클러스터를 대신 이용하도록 설정할 수 있다.  

주키퍼 앙상블은 hbase:meta 카탈로그 테이블의 위치, 현재 클러스터 마스터의 주소와 같은 아주 중요한 값을 가진다. 주키퍼는 중간에 리전을 할당할 때 참여하는 서버들 간의 충돌을 중재한다. 주키퍼는 할당 트랜잭션 상태를 관리하므로 고장나서 제외된 서버가 내버린 리전을 알아서 복구할 수 있다. 적어도 HBase 클러스터에 클라이언트 연결을 시작할 때 클라이언트는 주키퍼 앙상블의 위치를 전달받아야 한다. 그 후 클라이언트는 서버 위치와 같은 클러스터 속성을 알기 위해 주키퍼의 계층도를 탐색한다.  

<br/>

### HBase 특성

* 실제 인덱스가 없음
  * 로우는 순차적으로 저장되며 각 로우별 컬럼도 순차적으로 저장된다. 따라서 인덱스 확장과 같은 문제가 발생하지 않으며 입력 성능은 테이블의 크기와 무관하다
* 자동 분할
  * 테이블이 증가하면 자동으로 여러 리전으로 분할되고 가용한 모든 노드로 분산된다
* 새로운 노드를 추가하여 자동으로 선형 확장
  * 노드를 추가하고 이를 기존 클러스터에 붙이고 리전서버를 실행한다. 리전은 자동으로 균형을 맞추고 부하는 균등하게 분산될 것이다
* 범용 하드웨어
  * 클러스터는 50,000달러짜리가 아닌 1,000 ~ 5,000달러 정도의 범용 머신으로 구성된다. RDBMS는 I/O 성능이 중요하며 이러한 요구사항을 충족하는 하드웨어는 매우 비싸다
* 내고장성
  * 수많은 노드로 구성되었기 때문에 개별 노드는 상대적으로 큰 문제가 되지 않는다. 개별 노드의 장애에 대해 전혀 걱정할 필요가 없다
* 배치 처리
  * 맵리듀스와의 통합으로 데이터의 지역성을 준수하고 완전한 병렬성과 분산 작업을 지원한다

---

