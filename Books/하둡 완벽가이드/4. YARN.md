# YARN

아파치 YARN은 하둡의 클러스터 자원 관리 시스템이다.  
YARN은 클러스터의 자원을 요청하고 사용하기 위한 API를 제공한다. 하지만 사용자 코드에서 직접 이러한 API를 사용할 수는 없다. 사용자는 YARN이 내장된 분산 컴퓨팅 프레임워크에서 고수준 API를 작성해야 하며, 사용자는 자원 관리의 자세한 내용은 알 수 없다.  

<img width="746" alt="image" src="https://github.com/Be-poz/TIL/assets/45073750/ef2eba5e-61be-43fe-b4d6-917f2ea0077a">

맵리듀스, 스파크 등과 같은 분산 컴퓨팅 프레임워크는 클러스터 계산 계층(YARN)과 클러스터 저장 계층(HDFS, HBase) 위에서 YARN 애플리케이션을 실행한다.  

피그, 하이브, 크런치와 같은 애플리케이션은 맵리듀스, 스파크, 테즈에서 구동되는 처리 프레임워크의 예이며, YARN에 직접 접근하지는 않는다.  

<br/>

## YARN 애플리케이션 수행 해부해보기

* 리소스 매니저: 클러스터 전체 자원의 사용량을 관리

* 노드 매니저: 컨테이너를 구동하고 모니터링  

<img width="1005" alt="image" src="https://github.com/Be-poz/TIL/assets/45073750/3021a432-b12f-49be-93dd-4a98cda34a15">

1. 클라이언트는 YARN에서 애플리케이션을 구동하기 위해 리소스 매니저에 접속하여 애플리케이션 마스터 프로세스의 구동을 요청한다
2. 리소스 매니저는 컨테이너에서 애플리케이션 마스터를 시작할 수 있는 노드 매니저를 하나 찾는다
3. 애플리케이션 마스터가 단순한 계산을 단일 컨테이너에서 수행하고 그 결과를 클라이언트에 반환한 후 종료되거나, 리소스 매니저에 더 많은 컨테이너를 요청한다
4. 분산처리를 수행하는 경우도 있다

<br/>

## YARN과 맵리듀스 1의 차이점

YARN은 맵리듀스 1의 여러 한계를 극복하기 위해 설계되었다. YARN을 사용하여 얻을 수 있는 이익은 다음과 같다.  

* 확장성
* 가용성
* 효율성
* 멀티테넌시

<Br/>

## YARN 스케줄링

YARN은 FIFO, Capacity(가용량), Fair(균등) 스케줄러를 제공한다. 

<img width="954" alt="image" src="https://github.com/Be-poz/TIL/assets/45073750/1972dc75-68f2-488a-a819-1954e14e47c8">

* FIFO: 대형 잡이 완료될 때까지 작은 잡은 계속 대기한다
* Capacity: 작은 잡을 제출되면 즉시 분리된 전용 큐에서 처리해준다. 물론 해당 큐는 잡을 위한 자원을 미리 예약해두기 때문에 전체 클러스터의 효율성은 떨어진다. 또한 대형 잡은 FIFO 스케줄러보다 늦게 끝나게 된다
* Fair: 모든 잡의 자원을 동적으로 분배하기 때문에 미리 자원의 가용량을 예약할 필요가 없다. 대형 잡이 실행되는 도중에 작은 잡이 추가로 시작되면 페어 스케줄러는 클러스터 자원의 절반을 이 잡에 할당한다. 전체적으로 보면 클러스터의 효율성도 높고 작은 잡도 빨리 처리되는 효과가 있다

---



