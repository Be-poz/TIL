# 검색 시스템 이해하기

## 검색 시스템의 이해

### 검색 시스템이란?

검색엔진: 광활한 웹에서 정보를 수집해 검색 결과를 제공하는 프로그램  

검색 시스템: 대용량 데이터를 기반으로 신뢰성 있는 검색 결과를 제공하기 위해 검색엔진을 기반으로 구축된 시스템을 통칭하는 용어  

검색 서비스는 검색엔진을 기반으로 구축한 검색 시스템을 활용해 검색 결과를 서비스로 제공한다.  

검색 서비스 > 검색 시스템 > 검색엔진, 엘라스틱서치는 검색엔진이다.  

### 검색 시스템의 구성 요소

* 수집기: 필요한 정보를 수집하는 프로그램, 수집기가 정보를 수집하고 저장하면 검색엔진이 저장된 정보를 검색하고 질의에 답한다.
* 스토리지: DB에서 데이터를 저장하는 물리적인 저장소다. 검색엔진은 색인한 데이터를 스토리지에 보관한다.
* 색인기: 검색엔진이 수집한 정보에서 사용자 질의와 일치하는 정보를 찾으려면 수집된 데이터를 검색 가능한 구조로 가공하고 저장해야 한다. 그 역할을 하는 것이 색인기다. 색인기는 다양한 형태소 분석기를 조합해 정보에서 의미가 있는 용어를 추출하고 검색에 유리한 역색인 구조로 데이터를 저장한다.
* 검색기: 검색기는 사용자 질의를 입력받아 색인기에서 저장한 역색인 구조에서 일치하는 문서를 찾아 결과로 반환한다. 검색기 또한 색인기와 마찬가지로 형태소 분석기를 이용해 사용자 질의에서 유의미한 용어를 추출해 검색한다. 따라서 사용하는 형태소 분석기에 따라 검색 품질이 달라진다.  

수집기 -> 색인기 -> 스토리지 -> 검색기

### 관계형 데이터베이스와의 차이점

데이터베이스는 데이터를 통합 관리하는 데이터의 집합이다. 모든 데이터는 중복을 제거하고 정형 데이터로 구조화해 행과 열로 구성된 테이블에 저장된다. SQL 문을 이용해 원하는 정보의 검색이 가능한데 텍스트 매칭을 통한 단순한 검색만 가능하다. 텍스트를 여러 단어로 변형하거나 여러 개의 동의어나 유의어를 활용한 검색은 불가능하다.  

반면 검색엔진은 데이터베이스에서는 불가능한 비정형 데이터를 색인하고 검색할 수 있다. 형태소 분석을 통해 사람이 구사하는 자연어의 처리가 가능해지고 역색인 구조를 바탕으로 빠른 검색 속도를 보장한다.  

엘라스틱서치와 관계형 데이터베이스 비교  

| 엘라스틱서치 | 관계형 데이터베이스 |
| ------------ | ------------------- |
| 인덱스       | 데이터베이스        |
| 샤드         | 파티션              |
| 타입         | 테이블              |
| 문서         | 행                  |
| 필드         | 열(컬럼)            |
| 매핑         | 스키마              |
| Query DSL    | SQL                 |

엘라스틱서치는 기본적으로 HTTP를 통해 JSON 형식의 RESTful API를 이용한다.  

데이터베이스는 스키마를 미리 정의해야만 데이터 저장과 조회가 가능한 반면 엘라스틱서치는 구조화되지 않은 데이터까지 스스로 분석해 자동으로 필드를 생성하고 저장한다.  

<Br/>

## 검색 시스템과 엘라스틱서치

엘라스틱서치는 NoSQL의 일종으로서 분류가 가능하고 분산 처리를 통해 실시간에 준하는 빠른 검색이 가능하다.  
기존 데이터베이스로는 처리하기 어려운 대량의 비정형 데이터도 검색할 수 있으며, 전문 검색과 구조 검색 모두를 지원한다.  

### 엘라스틱서치가 강력한 이유

* 오픈소스 검색엔진
* 전문 검색: 전문 검색이란 내용 전체를 색인해서 특정 단어가 포함된 문서를 검색하는 것을 말한다.
* 통계 분석: 비정형 로그 데이터를 수집하고 한곳에 모아 통계 분석을 할 수 있다.
* 스키마리스: 정형화되지 않은 다양한 형태의 문서도 자동으로 색인하고 검색할 수 있다.
* RESTful API: HTTP 기반의 RESTful API를 지원한다.
* 멀티테넌시(Multi-tenancy): 서로 상이한 인덱스일지라도 검색할 필드명만 같으면 여러 개의 인덱스를 한 번에 조회할 수 있다.
* Document-Oriented: 여러 계층의 데이터를 JSON 형식의 구조화된 문서로 인덱스에 저장할 수 있다. 계층 구조로 문서도 한 번의 쿼리로 쉽게 조회할 수 있다.
* 역색인
* 확장성과 가용성

### 엘라스틱서치의 약점

1. 실시간이 아니다. 통상적으로 1초 뒤에나 검색이 가능해진다. 색인된 데이터는 내부적으로 커밋과 플러시 같은 복잡한 과정을 거치기 때문에 실시간이 아니다. 준 실시간이다.
2. 트랜잭션과 롤백 기능을 제공하지 않는다. 분산 시스템으로 구성되어 있고, 전체적인 클러스터의 성능 향상을 위해 시스템적으로 비용 소모가 큰 롤백과 트랜잭션을 지원하지 않기 때문에 최악의 경우 데이터 손실의 위험이 있다.
3. 데이터의 업데이트를 제공하지 않는다. 기존 문서를 삭제하고 새로운 문서를 생성하기 때문에 단순 업데이트에 비해 상대적으로 많은 비용이 발생한다. 하지만 이를 통해 불변적이라는 이점을 취할 수가 있다.

***
