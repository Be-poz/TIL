# 카프카 커넥트

카프카 커넥트는 아파치 카프카의 오픈소스 프로젝트 중 하나로, 데이터베이스와 같은 외부 시스템과 카프카를 손쉽게 연결하기 위한 프레임워크다. 커넥트의 주요 장점은 다음과 같다.

* 데이터 중심 파이프라인: 커넥트를 이용해 카프카로 데이터를 보내거나, 카프카로부터 데이터를 가져온다.
* 유연성과 확장성: 커넥트는 테스트 및 일회성 작업을 위한 단독 모드로 실행할 수 있고, 대규모 운영 환경을 위한 분산 모드로 실행할 수 있다.
* 재사용성과 기능 확장: 커넥트는 이미 만들어진 기존 커넥터들을 활용할 수도 있고 운영 환경에서의 요구사항에 맞춰 빠르게 확장이 가능하다. 커넥트의 이러한 손쉬운 확장 기능을 통해 운영 오버헤드를 낮출 수 있다.
* 장애 및 복구: 카프카 커넥트를 분산 모드로 실행하면 워커 노드의 장애 상황에도 유연하게 대응 가능하므로 고가용성이 보장된다.

## 카프카 커넥트의 핵심 개념

소스와 카프카 사이에 위치해서 프로듀서의 역할을 하는 것이 소스 커넥트이며, 카프카와 싱크 사이에 위치해서 컨슈머의 역할을 하는 것이 싱크 커넥트다. 

분산 모드로 두었을 때 특정 워커에 장애가 발생하더라도 해당 워커에서 동작 중인 커넥터나 태스크들은 다른 워커로 이동해 연속해서 동작할 수 있다.  

커넥터는 직접 데이터를 복사하지 않고, 데이터를 어디에서 어디로 복사해야 하는지의 작업을 정의하고 관리하는 역할을 한다.  
태스크는 커넥터가 정의한 작업을 직접 수행하는 역할을 한다.  

<Br/>

## 카프카 커넥트의 내부 동작

분산 배치된 각 태스크들은 메세지들을 소스에서 카프카로 혹은 카프카에서 싱크로 이동시킨다. 이때 커넥트는 파티셔닝 개념을 적용해 데이터들을 하위 집합으로 나눈다. 카프카에서도 병렬 처리를 위해 토픽을 파티션으로 나누는데 커넥트도 이와 동일하다.  

다만 커넥트에서 나눈 파티션과 토픽의 파티션은 용어만 같을 뿐 서로 아무 관계가 없다. 여기에서 나뉜 파티션들에는 오프셋과 같이 순차적으로 레코드들이 정렬된다.  

<br/>

## 분산 모드 카프카 커넥트

단독 모드와 분산 모드는 몇 가지 차이점이 있지만, 그중 가장 중요한 차이점은 메타 정보의 저장소 위치다. 분산 모드는 메타 정보의 저잦ㅇ소로 카프카 내부 토픽을 이용한다. 이렇게 카프카 내부 토픽을 이용하는 방법은 컨슈머 그룹들의 오프셋 정보를 ``__consumer_offsets`` 토픽에 저장하는 방법과 유사하다.  

카프카 커넥트에서 사용하는 토픽들은 커넥트 운영에서 중요한 정보가 저장되어 있으므로, 리플리케이션 팩터 수는 반드시 3으로 설정해야 한다. 카프카 커넥트는 안전한 메타 저장소를 바탕으로 확장성, 장애 허용, 자동 리밸런싱 등 운영에 필요한 필수 기능을 제공한다. 

---

