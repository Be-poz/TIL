# 웹 브라우저가 메시지를 만든다

## HTTP 리퀘스트 메시지를 작성한다

### 탐험 여행은 URL 입력부터 시작한다

http: , ftp: , file: , malito: 등 URL의 맨 앞에 있는 문자열은 액세스 하는 방법을 나타낸다. 웹 서버라면 HTTP, FTP 서버라면 FTP 프로토콜을 사용하는 식이다.

### 브라우저는 먼저 URL을 해독한다

URL은 ``http:`` + ``//`` + ``웹 서버명`` + ``/`` + ``디렉토리명`` + ``/``+ ... + ``파일명`` 의 요소를 가진다.  
앞에서 부터 설명하자면, 데이터 엑세스 방법, //는 나중에 이어지는 문자열이 서버의 이름임을 나타내고, 웹 서버명, 그 이후부터는 데이터 출처(파일)의 경로명을 나타낸다.  

``http://www.bepoz.com/dir1/file1.html`` 면 ``www.bepoz.com``이라는 웹 서버명의 ``/dir1/file1.html``의 파일에 엑세스한다는 의미이다. 만약 ``http://www.bepoz.com/dir1/``이라면 파일명을 쓰지 않고 생략한다는 뜻이다. 이 경우 어떤 파일을 액세스해야 할지 모르기 때문에 미리 서버측에 파일명을 설정해 둔다. 보통 ``default.html``이나 ``index.html``을 설정해둔다. ``http://www.bepoz.com``처럼 웹 서버의 도메인명만 쓴 경우도 마찬가지다. ``http://www.bepoz.com/file``이 경우는 파일명일 수도 디렉토리 명일 수도 있다. 이럴 떄에는 웹 서버에 ``file``이라는 파일이 있으면 파일명으로 보고, 디렉토리가 있으면 디렉토리명으로 본다.  

### HTTP의 기본 개념

HTTP 프로토콜은 클라이언트와 서버가 주고받는 메세지의 내용이나 순서를 정한 것이다. '무엇을', '어떻게 하는지' 를 판단한다. '무엇을' 은 URI를 보고, '어떻게 하는지' 는 메소드를 확인한다. (eg. GET, POST, PUT, DELETE, etc...)  

위는 리퀘스트 메시지고, 응답 메시지로는 Status를 포함한 메시지를 받게 된다.  

### HTTP 리퀘스트 메시지와 응답 메시지

첫 번째 행을 리퀘스트 라인이라고 한다. ``<메소드><공백><URI><공백><HTTP 버전>`` 의 형식을 띈다.  
그 다음 줄에는 메시지 헤더가 오게된다. 한 행에 한 개의 헤더 필드를 쓴다. 이 행을 통해 리퀘스트의 부가적인 정보를 나타낸다. 행 수는 상황에 따라 달라지며, 공백 행까지가 메시지 헤더가 된다. 공백 행 이후 메시지 본문이 나오게 되는데 서버에 송신하는 데이터가 들어가게 된다.  

응답 메시지는 스테이터스 라인이 먼저 나온다. ``<HTTP 버전><공백><스테이터스 코드><공백><응답 문구>``의 형식이다.  
이후 마찬가지로 메시지 헤더와 메시지 본문이 나온다. 메시지 본문에는 서버에서 클라이언트에 송신하는 데이터, 파일에서 읽은 데이터나 CGI 애플리케이션이 출력한 데이터가 들어가고, 바이너리 데이터로 취급된다.  

만약 ``/sample1.html`` 리퀘스트 메시지를 보내고 이에 대한 응답 메시지를 받았다고 하자. 해당 본문에 ``/bepoz.jpg``가 있으면 이를 위해 다시 리퀘스트 메시지를 보내고 응답을 받게 된다. 즉, 만약 한 문장에 n개의 영상이 포함되어 있다면 문장 파일을 읽는 리퀘스트와 영상 파일을 읽는 리퀘스트로, 총 n+1회 리퀘스트 메시지를 웹 서버에 보내게 된다.  

<br/>

## 웹 서버의 IP주소를 DNS서버에 조회한다

### IP 주소의 기본

HTTP의 메시지를 만들면 다음에는 OS에 의뢰해서 엑세스 대상 웹 서버에게 송신한다. 브라우저는 URL을 해독하거나 HTTP 메시지를 만들지만, 네트워크 송출 기능은 없기 때문에 OS에게 의뢰해서 송신하는 것이다. OS에 송신을 의뢰할 때는 도메인명이 아니라 IP 주소로 상대를 지정해야 하기 때문에 IP 주소가 필요하다.  

서브넷이라는 작은 네트워크를 라우터로 접속하여 전체 네트워크가 만들어진다. 서브넷이란, 허브에 몇 대의 PC가 접속된 것이라고 생각하면 된다. 이것을 한 개의 단위로 생각하여 '서브넷' 이라고 부른다. 서브넷에 해당하는 주소를 네트워크 번호, 각 호스트한테는 호스트 번호라 하고, 이 두 주소를 합쳐서 IP주소라고 한다.  

### 도메인명과 IP 주소를 구분하여 사용하는 이유

IP 주소는 32비트, 즉 4바이트에 해당하는 개수 밖에 없지만, 도메인명은 최대 255바이트나 있기 때문에 그만큼 라우터가 부하되어 데이터를 운반하는 동작에 더 많은 시간이 걸리면서 네트워크의 속도가 느려진다. 고성능 라우터를 사용한다고 하더라도 라우터의 속도에는 한계가 있고, 한계에 다다르면 방대한 양의 데이터가 인터넷의 내부에 정체되어 있을 수 있다.  

이름을 알면 IP 주소를 알 수 있고, IP 주소를 알면 이름을 알 수 있는 원리를 사용하여 양쪽의 차이를 해소하는 방식을 택하고 있다. 그 원리가 DNS 이다.  

### Socket 라이브러리가 IP 주소를 찾는 기능을 제공한다

IP 주소를 조사하는 방법은 가장 가까운 DNS 서버에 묻는 것이다. DNS 서버에 대해 클라이언트로 동작한다고 말할 수 있다. 이 클라이언트에 해당하는 것을 DNS 리졸버 또는 단순히 리졸버라고 부른다. DNS의 원리를 사용하여 IP 주소를 조사하는 것을 네임 리졸루션이라고 한다. 이 리졸루션을 실행하는 것이 리졸버이다.  

리졸버는 Socket 라이브러리에 들어있는 프로그램이다. OS에 포함되어 있는 네트워크의 기능을 애플리케이션에서 호출하기 위해 Socket 라이브러리가 있는 것이다.  

### 리졸버를 이용하여 DNS 서버를 조회한다

리졸버의 프로그램명(gethostbyname)과 웹 서버의 이름을 써서 리졸버를 호출할 수 있다. 리졸버를 호출하면 리졸버가 DNS 서버에 조회 메시지를 보내고, DNS 서버에서 응답 메시지가 돌아온다. 이 응답 메시지 속에 IP 주소가 포함되어 있으므로 이것을 추출하여 브라우저에서 지정한 메모리 영역에 써넣는다. 브라우저가 웹 서버에 메시지를 보낼 때 이 메모리 영역에서 IP 주소를 추출하여 OS에게 건네줌으로써 송신을 의뢰하게 된다.  

### 리졸버 내부의 작동

DNS 서버에게 메시지를 송신하는 것은 리졸버가 스스로 실행하는 것이 아니라 OS 내부에 포함된 **프로토콜 스택**을 호출하여 실행을 의뢰한다. 리졸버도 브라우저와 같이 네트워크에 대한 데이터를 송수신하는 기능이 없기 때문이다. (프로토콜 스택이란 OS에 내장된 네트워크 제어용 소프트웨어다. '프로토콜 드라이버', 'TCP/IP 소프트웨어' 등으로도 불린다)  

리졸버가 프로토콜 스택을 호출하면 제어가 리졸버에게 넘어가고 여기에서 메시지를 보내는 동작을 실행하여 LAN 어댑터를 통해 메시지가 DNS 서버를 향해 송신된다. 리졸버의 동작이 끝나고 제어가 애플리케이션(브라우저)에게 돌아온다. 이와 같이 컴퓨터의 내부는 다층 구조로 되어 있고 상위 계층에서 무엇인가 일을 의뢰했을 때 그 일을 스스로 전부 실행하지 않고 하위 계층에 실행을 의뢰하면서 처리를 진행한다.  

DNS 서버에 메시지를 송신할 때도 DNS 서버의 IP 주소가 필요하다. 이것은 TCP/IP 설정 항목의 하나하나로 컴퓨터에 미리 설정되어 있다. 리졸버는 여기에서 설정한 DNS 서버의 IP 주소에 조회 메시지를 보내게 된다.  

<br/>

