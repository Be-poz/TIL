# 운영 클러스터 구축

## 성능과 안정성을 위한 운영 클러스터 고려사항

엘라스틱서치는 빠른 성능을 위해 시스템 리소스를 많이 소비하는 편이므로 충분한 하드웨어를 확보해주고, 컬러스터링괍 ㅜㄴ산/병렬 처리 개념을 이해해 노드를 구성할 필요가 있다.  

### 노드 구성 계획

마스터 노드는 많은 리소스를 사용하지는 않지만 장애가 발생하면 클러스터 전체에 영향을 미치므로 마스터 전용 노드를 운영하는 방식이 바람직하다. 데이터 노드 또한 레플리카를 제대로 활용하기 위해 최소 2대 이상 확보해야 한다. 그리고 인덱싱 부하량, 검색 부하량 등을 고려해 인제스트나 코디네이팅 전용 노드를 추가할지 여부를 고려하고 머신러닝을 사용한다면 머신러닝 노드를 추가해주면 된다.  

### 하드웨어 선정

엘라스틱서치는 단일 노드의 하드웨어가 굉장히 좋을 필요는 없지만 낮은 사양의 하드웨어는 병목이 되기도 한다.  
사양이 좋은 컴퓨터 하나를 노드로 두는 것 보다 적당히 좋은 컴퓨터 2개를 노드로 두는 것이 비용이나 성능 면에서 유리하다.  

* 메모리: 64GB가 가장 이상적이다
* CPU: 단일 코어의 성능이 좋은 CPU 보다 코어의 수가 많은 CPU 중 후자가 더 낫다. 무거운 집계나 인덱싱을 수행하는 경우 CPU 성능이 병목이 될 수 있다
* 디스크: SSD를 권장, 하드 디스크 사용 시 RPM이 빠른 제품을 선택
* 하드웨어 통일: 각 노드들의 하드웨어 성능을 통일하는 것이 중요하다. 엘라스틱서치는 분산 검색 엔진인 만큼 조회 대상 샤드가 위치한 모든 노드에서 처리한 후 코디네이팅 노드에서 결과를 취합해 반환하게 되므로, 검색의 총 실행 시간은 가장 느린 노드가 코디네이팅 노드로 결과를 전달한 시간 + @가 된다. 마스터 노드는 클러스터의 규모, 코디네이팅 노드는 예상되는 API 요청량, 인제스트 노드는 인덱싱 요청량과 문서 가공을 위한 파이프라인의 복잡도 등을 고려하자
* 스냅샷 처리: 스냅샷 저장소를 위한 하드웨어를 고려해야 한다. 용량을 기준으로 선정해야 하며 모든 노드에서 접근 가능하도록 네트워크 공유 드라이브를 구성해야 한다

### 엘라스틱서치 버전 선정

엘라스틱서치 버전은 특별한 상황이 아니라면 최신 버전을 사용하는 것이 좋다.
***
